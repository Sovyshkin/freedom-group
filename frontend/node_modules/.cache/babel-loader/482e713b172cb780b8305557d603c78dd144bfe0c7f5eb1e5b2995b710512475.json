{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\n\n// Устанавливаем базовый URL для API\naxios.defaults.baseURL = 'http://localhost:3001/api';\n// axios.defaults.baseURL = 'http://87.236.23.19:1337/api';\n\n// Настройка interceptor для автоматической обработки истечения токенов\nlet isRefreshing = false;\nlet failedQueue = [];\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n  failedQueue = [];\n};\n\n// Request interceptor для добавления токена к каждому запросу\naxios.interceptors.request.use(config => {\n  const token = localStorage.getItem('jwt');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Response interceptor для обработки ответов\naxios.interceptors.response.use(response => {\n  return response;\n}, async error => {\n  const originalRequest = error.config;\n  if (error.response?.status === 401 && !originalRequest._retry) {\n    if (isRefreshing) {\n      // Если уже обновляем токен, добавляем запрос в очередь\n      return new Promise((resolve, reject) => {\n        failedQueue.push({\n          resolve,\n          reject\n        });\n      }).then(token => {\n        originalRequest.headers.Authorization = `Bearer ${token}`;\n        return axios(originalRequest);\n      }).catch(err => {\n        return Promise.reject(err);\n      });\n    }\n    originalRequest._retry = true;\n    isRefreshing = true;\n    const refreshToken = localStorage.getItem('refreshToken');\n    if (refreshToken) {\n      try {\n        const response = await axios.post('/auth/refresh', {\n          refreshToken: refreshToken\n        });\n        const {\n          jwt: newToken\n        } = response.data;\n        localStorage.setItem('jwt', newToken);\n\n        // Обновляем заголовок по умолчанию\n        axios.defaults.headers.common['Authorization'] = `Bearer ${newToken}`;\n        processQueue(null, newToken);\n\n        // Повторяем оригинальный запрос с новым токеном\n        originalRequest.headers.Authorization = `Bearer ${newToken}`;\n        return axios(originalRequest);\n      } catch (refreshError) {\n        processQueue(refreshError, null);\n\n        // Удаляем токены и перенаправляем на логин\n        localStorage.removeItem('jwt');\n        localStorage.removeItem('refreshToken');\n        localStorage.removeItem('tokenExpiration');\n        localStorage.removeItem('user');\n\n        // Перенаправляем на страницу входа\n        window.location.href = '/login';\n        return Promise.reject(refreshError);\n      } finally {\n        isRefreshing = false;\n      }\n    } else {\n      // Нет refresh токена, перенаправляем на логин\n      localStorage.removeItem('jwt');\n      localStorage.removeItem('refreshToken');\n      localStorage.removeItem('tokenExpiration');\n      localStorage.removeItem('user');\n      window.location.href = '/login';\n      return Promise.reject(error);\n    }\n  }\n  return Promise.reject(error);\n});\nexport default axios;","map":{"version":3,"names":["axios","defaults","baseURL","isRefreshing","failedQueue","processQueue","error","token","forEach","prom","reject","resolve","interceptors","request","use","config","localStorage","getItem","headers","Authorization","Promise","response","originalRequest","status","_retry","push","then","catch","err","refreshToken","post","jwt","newToken","data","setItem","common","refreshError","removeItem","window","location","href"],"sources":["/Users/vadim/Desktop/freedom-group/frontend/src/plugins/axios.js"],"sourcesContent":["import axios from 'axios';\n\n// Устанавливаем базовый URL для API\naxios.defaults.baseURL = 'http://localhost:3001/api'; \n// axios.defaults.baseURL = 'http://87.236.23.19:1337/api';\n\n// Настройка interceptor для автоматической обработки истечения токенов\nlet isRefreshing = false;\nlet failedQueue = [];\n\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n  \n  failedQueue = [];\n};\n\n// Request interceptor для добавления токена к каждому запросу\naxios.interceptors.request.use(\n  (config) => {\n    const token = localStorage.getItem('jwt');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Response interceptor для обработки ответов\naxios.interceptors.response.use(\n  (response) => {\n    return response;\n  },\n  async (error) => {\n    const originalRequest = error.config;\n\n    if (error.response?.status === 401 && !originalRequest._retry) {\n      if (isRefreshing) {\n        // Если уже обновляем токен, добавляем запрос в очередь\n        return new Promise((resolve, reject) => {\n          failedQueue.push({ resolve, reject });\n        }).then(token => {\n          originalRequest.headers.Authorization = `Bearer ${token}`;\n          return axios(originalRequest);\n        }).catch(err => {\n          return Promise.reject(err);\n        });\n      }\n\n      originalRequest._retry = true;\n      isRefreshing = true;\n\n      const refreshToken = localStorage.getItem('refreshToken');\n\n      if (refreshToken) {\n        try {\n          const response = await axios.post('/auth/refresh', {\n            refreshToken: refreshToken\n          });\n\n          const { jwt: newToken } = response.data;\n          localStorage.setItem('jwt', newToken);\n          \n          // Обновляем заголовок по умолчанию\n          axios.defaults.headers.common['Authorization'] = `Bearer ${newToken}`;\n          \n          processQueue(null, newToken);\n          \n          // Повторяем оригинальный запрос с новым токеном\n          originalRequest.headers.Authorization = `Bearer ${newToken}`;\n          return axios(originalRequest);\n          \n        } catch (refreshError) {\n          processQueue(refreshError, null);\n          \n          // Удаляем токены и перенаправляем на логин\n          localStorage.removeItem('jwt');\n          localStorage.removeItem('refreshToken');\n          localStorage.removeItem('tokenExpiration');\n          localStorage.removeItem('user');\n          \n          // Перенаправляем на страницу входа\n          window.location.href = '/login';\n          \n          return Promise.reject(refreshError);\n        } finally {\n          isRefreshing = false;\n        }\n      } else {\n        // Нет refresh токена, перенаправляем на логин\n        localStorage.removeItem('jwt');\n        localStorage.removeItem('refreshToken');\n        localStorage.removeItem('tokenExpiration');\n        localStorage.removeItem('user');\n        \n        window.location.href = '/login';\n        return Promise.reject(error);\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport default axios;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}