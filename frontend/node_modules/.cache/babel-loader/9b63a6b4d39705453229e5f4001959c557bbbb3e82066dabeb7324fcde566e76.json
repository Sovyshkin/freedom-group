{"ast":null,"code":"import { ref, onMounted, onUnmounted, nextTick, computed } from 'vue';\n// import LogInButton from \"@/components/ui/buttons/LogInButton.vue\";\nimport SendAgainButton from \"@/components/ui/buttons/SendAgainButton.vue\";\nimport { useMainStore } from \"@/stores/main.ts\";\nexport default {\n  __name: 'EmailVerify',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const mainStore = useMainStore();\n    const digits = ref(['', '', '', '']);\n    const inputs = ref([]);\n    const canResend = ref(false);\n    const countdown = ref(60); // 60 секунд таймера\n    const timerInterval = ref(null); // Ссылка на интервал таймера\n\n    const handleInput = (index, event) => {\n      const value = event.target.value.replace(/\\D/g, ''); // Оставляем только цифры\n\n      digits.value[index] = value;\n\n      // Если введено число и есть следующий инпут, переходим к нему\n      if (value && index < digits.value.length - 1) {\n        nextTick(() => {\n          inputs.value[index + 1]?.focus();\n        });\n      }\n\n      // Автоматическая отправка при заполнении всех полей\n      if (digits.value.every(digit => digit !== '')) {\n        handleLogin();\n      }\n    };\n    const handleKeydown = (index, event) => {\n      // Обработка удаления и перемещения между полями\n      if (event.key === 'Backspace' && !digits.value[index] && index > 0) {\n        inputs.value[index - 1]?.focus();\n      }\n    };\n    const handlePaste = event => {\n      event.preventDefault();\n      const pasteData = event.clipboardData.getData('text').replace(/\\D/g, '');\n\n      // Вставляем только первые 4 цифры\n      const codes = pasteData.slice(0, 4).split('');\n      codes.forEach((code, index) => {\n        if (index < digits.value.length) {\n          digits.value[index] = code;\n        }\n      });\n\n      // Переходим к последнему заполненному инпуту\n      const lastFilledIndex = Math.min(codes.length - 1, digits.value.length - 1);\n      nextTick(() => {\n        inputs.value[lastFilledIndex]?.focus();\n      });\n      handleLogin();\n    };\n    const handleLogin = () => {\n      console.log('handleLogin called with code:', digits.value.join(''));\n      mainStore.code = digits.value.join('');\n      if (mainStore.code.length === 4) {\n        mainStore.verifyCode();\n      }\n    };\n\n    // Функция для запуска таймера\n    const startCountdown = () => {\n      console.log('startCountdown called, current countdown:', countdown.value, 'canResend:', canResend.value);\n\n      // Не перезапускаем таймер если он уже идет\n      if (!canResend.value && countdown.value > 0 && timerInterval.value) {\n        console.log('Timer already running, not restarting');\n        return;\n      }\n\n      // Очищаем предыдущий таймер если есть\n      if (timerInterval.value) {\n        clearInterval(timerInterval.value);\n      }\n      canResend.value = false;\n      countdown.value = 60;\n      timerInterval.value = setInterval(() => {\n        countdown.value -= 1;\n        if (countdown.value <= 0) {\n          clearInterval(timerInterval.value);\n          timerInterval.value = null;\n          canResend.value = true;\n          console.log('Timer finished, can resend now');\n        }\n      }, 1000);\n    };\n\n    // Обработчик повторной отправки\n    const handleResend = () => {\n      if (canResend.value) {\n        // Вызов метода отправки кода из store\n        mainStore.sendCodeAgain();\n        startCountdown();\n      }\n    };\n\n    // Форматирование времени для таймера\n    const formattedTime = computed(() => {\n      const seconds = countdown.value;\n      return `00:${seconds.toString().padStart(2, '0')}`;\n    });\n\n    // Фокус на первый инпут при монтировании\n    onMounted(() => {\n      console.log('EmailVerify component mounted');\n      nextTick(() => {\n        inputs.value[0]?.focus();\n      });\n\n      // Запускаем таймер при загрузке компонента только если он не запущен\n      console.log('About to start countdown, current state:', countdown.value, canResend.value);\n      startCountdown();\n    });\n\n    // Очищаем таймер при размонтировании\n    onUnmounted(() => {\n      console.log('EmailVerify component unmounted, clearing timer');\n      if (timerInterval.value) {\n        clearInterval(timerInterval.value);\n        timerInterval.value = null;\n      }\n    });\n    const __returned__ = {\n      mainStore,\n      digits,\n      inputs,\n      canResend,\n      countdown,\n      timerInterval,\n      handleInput,\n      handleKeydown,\n      handlePaste,\n      handleLogin,\n      startCountdown,\n      handleResend,\n      formattedTime,\n      ref,\n      onMounted,\n      onUnmounted,\n      nextTick,\n      computed,\n      SendAgainButton,\n      get useMainStore() {\n        return useMainStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","nextTick","computed","SendAgainButton","useMainStore","mainStore","digits","inputs","canResend","countdown","timerInterval","handleInput","index","event","value","target","replace","length","focus","every","digit","handleLogin","handleKeydown","key","handlePaste","preventDefault","pasteData","clipboardData","getData","codes","slice","split","forEach","code","lastFilledIndex","Math","min","console","log","join","verifyCode","startCountdown","clearInterval","setInterval","handleResend","sendCodeAgain","formattedTime","seconds","toString","padStart"],"sources":["/Users/vadim/Desktop/freedom-group/frontend/src/views/auth/EmailVerify.vue"],"sourcesContent":["<script setup>\nimport { ref, onMounted, onUnmounted, nextTick, computed } from 'vue'\n// import LogInButton from \"@/components/ui/buttons/LogInButton.vue\";\nimport SendAgainButton from \"@/components/ui/buttons/SendAgainButton.vue\";\nimport { useMainStore } from \"@/stores/main.ts\";\n\nconst mainStore = useMainStore();\n\nconst digits = ref(['', '', '', ''])\nconst inputs = ref([])\nconst canResend = ref(false)\nconst countdown = ref(60) // 60 секунд таймера\nconst timerInterval = ref(null) // Ссылка на интервал таймера\n\nconst handleInput = (index, event) => {\n  const value = event.target.value.replace(/\\D/g, '') // Оставляем только цифры\n  \n  digits.value[index] = value\n  \n  // Если введено число и есть следующий инпут, переходим к нему\n  if (value && index < digits.value.length - 1) {\n    nextTick(() => {\n      inputs.value[index + 1]?.focus()\n    })\n  }\n  \n  // Автоматическая отправка при заполнении всех полей\n  if (digits.value.every(digit => digit !== '')) {\n    handleLogin()\n  }\n}\n\nconst handleKeydown = (index, event) => {\n  // Обработка удаления и перемещения между полями\n  if (event.key === 'Backspace' && !digits.value[index] && index > 0) {\n    inputs.value[index - 1]?.focus()\n  }\n}\n\nconst handlePaste = (event) => {\n  event.preventDefault()\n  const pasteData = event.clipboardData.getData('text').replace(/\\D/g, '')\n  \n  // Вставляем только первые 4 цифры\n  const codes = pasteData.slice(0, 4).split('')\n  \n  codes.forEach((code, index) => {\n    if (index < digits.value.length) {\n      digits.value[index] = code\n    }\n  })\n  \n  // Переходим к последнему заполненному инпуту\n  const lastFilledIndex = Math.min(codes.length - 1, digits.value.length - 1)\n  nextTick(() => {\n    inputs.value[lastFilledIndex]?.focus()\n  })\n\n  handleLogin()\n}\n\nconst handleLogin = () => {\n  console.log('handleLogin called with code:', digits.value.join(''));\n  mainStore.code = digits.value.join('')\n  if (mainStore.code.length === 4) {\n    mainStore.verifyCode()\n  }\n}\n\n// Функция для запуска таймера\nconst startCountdown = () => {\n  console.log('startCountdown called, current countdown:', countdown.value, 'canResend:', canResend.value);\n  \n  // Не перезапускаем таймер если он уже идет\n  if (!canResend.value && countdown.value > 0 && timerInterval.value) {\n    console.log('Timer already running, not restarting');\n    return;\n  }\n  \n  // Очищаем предыдущий таймер если есть\n  if (timerInterval.value) {\n    clearInterval(timerInterval.value);\n  }\n  \n  canResend.value = false\n  countdown.value = 60\n  \n  timerInterval.value = setInterval(() => {\n    countdown.value -= 1\n    \n    if (countdown.value <= 0) {\n      clearInterval(timerInterval.value)\n      timerInterval.value = null\n      canResend.value = true\n      console.log('Timer finished, can resend now');\n    }\n  }, 1000)\n}\n\n// Обработчик повторной отправки\nconst handleResend = () => {\n  if (canResend.value) {\n    // Вызов метода отправки кода из store\n    mainStore.sendCodeAgain()\n    startCountdown()\n  }\n}\n\n// Форматирование времени для таймера\nconst formattedTime = computed(() => {\n  const seconds = countdown.value\n  return `00:${seconds.toString().padStart(2, '0')}`\n})\n\n// Фокус на первый инпут при монтировании\nonMounted(() => {\n  console.log('EmailVerify component mounted');\n  nextTick(() => {\n    inputs.value[0]?.focus()\n  })\n  \n  // Запускаем таймер при загрузке компонента только если он не запущен\n  console.log('About to start countdown, current state:', countdown.value, canResend.value);\n  startCountdown()\n})\n\n// Очищаем таймер при размонтировании\nonUnmounted(() => {\n  console.log('EmailVerify component unmounted, clearing timer');\n  if (timerInterval.value) {\n    clearInterval(timerInterval.value);\n    timerInterval.value = null;\n  }\n})\n</script>\n\n<template>\n  <div class=\"wrap\">\n    <div class=\"wrap-image\">\n      <img src=\"@/assets/email.svg\" alt=\"Email Icon\" />\n    </div>\n    <h1>Авторизация</h1>\n    <p>Мы отправили код для авторизации. На почту {{ mainStore.email }}</p>\n    \n    <div class=\"code-inputs\">\n      <input\n        v-for=\"(digit, index) in digits\"\n        :key=\"index\"\n        v-model=\"digits[index]\"\n        @input=\"handleInput(index, $event)\"\n        @keydown=\"handleKeydown(index, $event)\"\n        @paste=\"handlePaste\"\n        type=\"text\"\n        inputmode=\"numeric\"\n        pattern=\"[0-9]*\"\n        maxlength=\"1\"\n        class=\"code-input\"\n        :ref=\"el => { if (el) inputs[index] = el }\"\n      />\n    </div>\n    \n    <div class=\"wrap-buttons\">\n      <!-- <LogInButton/> -->\n      <SendAgainButton \n        :disabled=\"!canResend\" \n        @click=\"handleResend\"\n      />\n      \n      <div v-if=\"!canResend\" class=\"timer-section\">\n        <p class=\"timer-text\">Отправить код повторно можно через:</p>\n        <div class=\"timer\">\n          <span class=\"timer-digits\">{{ formattedTime }}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.wrap {\n  margin: 0 auto;\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n  justify-content: center;\n  height: 100vh;\n  gap: 24px;\n  width: 360px;\n}\n\n.wrap-image {\n  width: 64px;\n  height: 64px;\n  background-color: rgba(18, 51, 234, 0.1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  border-radius: 50%;\n}\n\n.wrap-image img {\n  width: 32px;\n  height: 32px;\n}\n\nh1 {\n  font-size: 24px;\n  font-weight: 600;\n  color: #333;\n  margin: 0;\n}\n\np {\n  text-align: center;\n  color: #666;\n  margin: 0;\n  line-height: 1.5;\n}\n\n.code-inputs {\n  display: flex;\n  gap: 12px;\n  margin: 16px 0;\n}\n\n.code-input {\n  width: 50px;\n  height: 50px;\n  text-align: center;\n  font-size: 24px;\n  border: 1px solid #ddd;\n  border-radius: 8px;\n  transition: border-color 0.2s;\n}\n\n.code-input:focus {\n  border-color: #1233ea;\n  outline: none;\n  box-shadow: 0 0 0 2px rgba(18, 51, 234, 0.2);\n}\n\n.wrap-buttons {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  width: 100%;\n  align-items: center;\n}\n\n.timer-section {\n  text-align: center;\n  margin-top: 8px;\n}\n\n.timer-text {\n  font-size: 14px;\n  color: #666;\n  margin-bottom: 8px;\n}\n\n.timer {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: #1233EA;\n  color: white;\n  padding: 8px 16px;\n  border-radius: 20px;\n  font-family: 'Courier New', monospace;\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n}\n\n.timer-digits {\n  font-size: 18px;\n  font-weight: 600;\n  letter-spacing: 2px;\n  color: white;\n}\n\n/* Стили для disabled кнопки */\nbutton:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n/* Анимация для таймера */\n.timer {\n  animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n  0% {\n    transform: scale(1);\n    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n  }\n  50% {\n    transform: scale(1.05);\n    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);\n  }\n  100% {\n    transform: scale(1);\n    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n  }\n}\n\n/* Responsive Design */\n@media (max-width: 480px) {\n  .wrap {\n    min-width: 100%;\n    max-width: 100%;\n    padding: 0 16px;\n    gap: 20px;\n  }\n  \n  h1 {\n    font-size: 24px;\n  }\n  \n  .code-input {\n    width: 45px;\n    height: 45px;\n    font-size: 20px;\n  }\n  \n  .code-inputs {\n    gap: 8px;\n  }\n  \n  .text-info {\n    font-size: 14px;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}