{"ast":null,"code":"import { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport api from '@/plugins/axios';\nexport const useAuthStore = defineStore('auth', () => {\n  // State\n  const user = ref(null);\n  const token = ref(localStorage.getItem('authToken') || null);\n  const isAuthenticated = ref(!!token.value);\n  const loading = ref(false);\n  const initialized = ref(false);\n\n  // Загружаем user из localStorage при инициализации\n  const storedUser = localStorage.getItem('authUser');\n  if (storedUser) {\n    try {\n      user.value = JSON.parse(storedUser);\n    } catch (e) {\n      console.error('Error parsing stored user:', e);\n      localStorage.removeItem('authUser');\n    }\n  }\n\n  // Actions\n  const login = async (endpoint, credentials) => {\n    try {\n      const response = await api.post(endpoint, credentials);\n      if (response.data.success) {\n        token.value = response.data.token;\n        user.value = response.data.user;\n        isAuthenticated.value = true;\n\n        // Store token and user in localStorage\n        localStorage.setItem('authToken', token.value);\n        localStorage.setItem('authUser', JSON.stringify(user.value));\n\n        // Set default authorization header\n        api.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n        return response.data;\n      } else {\n        throw new Error(response.data.message || 'Login failed');\n      }\n    } catch (error) {\n      console.error('Login error:', error);\n      throw error;\n    }\n  };\n  const logout = () => {\n    user.value = null;\n    token.value = null;\n    isAuthenticated.value = false;\n\n    // Remove token and user from localStorage\n    localStorage.removeItem('authToken');\n    localStorage.removeItem('authUser');\n\n    // Remove authorization header\n    delete api.defaults.headers.common['Authorization'];\n  };\n  const initializeAuth = async () => {\n    if (token.value) {\n      // Set authorization header\n      api.defaults.headers.common['Authorization'] = `Bearer ${token.value}`;\n      try {\n        // Проверяем токен и получаем данные пользователя с сервера\n        const response = await api.get('/auth/verify');\n        if (response.data.success) {\n          user.value = response.data.user;\n          isAuthenticated.value = true;\n\n          // Обновляем user в localStorage\n          localStorage.setItem('authUser', JSON.stringify(user.value));\n          console.log('Auth initialized with valid token');\n        } else {\n          // Токен невалиден\n          console.log('Token is invalid, logging out');\n          logout();\n        }\n      } catch (error) {\n        // Ошибка при проверке токена (например, токен истек)\n        console.error('Token verification failed:', error);\n        logout();\n      }\n    } else {\n      console.log('No token found, user is not authenticated');\n    }\n    initialized.value = true;\n  };\n  const initAuth = async () => {\n    return initializeAuth();\n  };\n  const updateUser = userData => {\n    user.value = {\n      ...user.value,\n      ...userData\n    };\n  };\n  return {\n    // State\n    user,\n    token,\n    isAuthenticated,\n    loading,\n    initialized,\n    // Actions\n    login,\n    logout,\n    initAuth,\n    initializeAuth,\n    updateUser\n  };\n});","map":{"version":3,"names":["defineStore","ref","api","useAuthStore","user","token","localStorage","getItem","isAuthenticated","value","loading","initialized","storedUser","JSON","parse","e","console","error","removeItem","login","endpoint","credentials","response","post","data","success","setItem","stringify","defaults","headers","common","Error","message","logout","initializeAuth","get","log","initAuth","updateUser","userData"],"sources":["/Users/vadim/Desktop/freedom-group/frontend/src/stores/auth.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\nimport api from '@/plugins/axios'\n\nexport const useAuthStore = defineStore('auth', () => {\n  // State\n  const user = ref(null)\n  const token = ref(localStorage.getItem('authToken') || null)\n  const isAuthenticated = ref(!!token.value)\n  const loading = ref(false)\n  const initialized = ref(false)\n\n  // Загружаем user из localStorage при инициализации\n  const storedUser = localStorage.getItem('authUser')\n  if (storedUser) {\n    try {\n      user.value = JSON.parse(storedUser)\n    } catch (e) {\n      console.error('Error parsing stored user:', e)\n      localStorage.removeItem('authUser')\n    }\n  }\n\n  // Actions\n  const login = async (endpoint, credentials) => {\n    try {\n      const response = await api.post(endpoint, credentials)\n      \n      if (response.data.success) {\n        token.value = response.data.token\n        user.value = response.data.user\n        isAuthenticated.value = true\n        \n        // Store token and user in localStorage\n        localStorage.setItem('authToken', token.value)\n        localStorage.setItem('authUser', JSON.stringify(user.value))\n        \n        // Set default authorization header\n        api.defaults.headers.common['Authorization'] = `Bearer ${token.value}`\n        \n        return response.data\n      } else {\n        throw new Error(response.data.message || 'Login failed')\n      }\n    } catch (error) {\n      console.error('Login error:', error)\n      throw error\n    }\n  }\n\n  const logout = () => {\n    user.value = null\n    token.value = null\n    isAuthenticated.value = false\n    \n    // Remove token and user from localStorage\n    localStorage.removeItem('authToken')\n    localStorage.removeItem('authUser')\n    \n    // Remove authorization header\n    delete api.defaults.headers.common['Authorization']\n  }\n\n  const initializeAuth = async () => {\n    if (token.value) {\n      // Set authorization header\n      api.defaults.headers.common['Authorization'] = `Bearer ${token.value}`\n      \n      try {\n        // Проверяем токен и получаем данные пользователя с сервера\n        const response = await api.get('/auth/verify')\n        \n        if (response.data.success) {\n          user.value = response.data.user\n          isAuthenticated.value = true\n          \n          // Обновляем user в localStorage\n          localStorage.setItem('authUser', JSON.stringify(user.value))\n          \n          console.log('Auth initialized with valid token')\n        } else {\n          // Токен невалиден\n          console.log('Token is invalid, logging out')\n          logout()\n        }\n      } catch (error) {\n        // Ошибка при проверке токена (например, токен истек)\n        console.error('Token verification failed:', error)\n        logout()\n      }\n    } else {\n      console.log('No token found, user is not authenticated')\n    }\n    initialized.value = true\n  }\n\n  const initAuth = async () => {\n    return initializeAuth()\n  }\n\n  const updateUser = (userData) => {\n    user.value = { ...user.value, ...userData }\n  }\n\n  return {\n    // State\n    user,\n    token,\n    isAuthenticated,\n    loading,\n    initialized,\n    \n    // Actions\n    login,\n    logout,\n    initAuth,\n    initializeAuth,\n    updateUser\n  }\n})"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}