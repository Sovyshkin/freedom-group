{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport { useAuthStore } from '@/stores/auth';\nconst routes = [{\n  path: '/',\n  name: 'home',\n  redirect: '/login'\n}, {\n  path: '/login',\n  name: 'login',\n  component: () => import('@/views/auth/LoginPage.vue'),\n  meta: {\n    requiresGuest: true\n  }\n}, {\n  path: '/forgot-password',\n  name: 'forgot-password',\n  component: () => import('@/views/auth/ForgotPassword.vue'),\n  meta: {\n    requiresGuest: true\n  }\n}, {\n  path: '/reset-password',\n  name: 'reset-password',\n  component: () => import('@/views/auth/ResetPassword.vue'),\n  meta: {\n    requiresGuest: true\n  }\n}, {\n  path: '/verify-email',\n  name: 'verify-email',\n  component: () => import('@/views/auth/EmailVerify.vue'),\n  meta: {\n    requiresGuest: true\n  }\n}, {\n  path: '/admin',\n  name: 'admin',\n  component: () => import('@/views/AdminDashboard.vue'),\n  meta: {\n    requiresAuth: true,\n    requiresRole: 'admin'\n  }\n}, {\n  path: '/dashboard',\n  name: 'dashboard',\n  component: () => import('@/views/PartnerDashboard.vue'),\n  meta: {\n    requiresAuth: true,\n    requiresRole: 'partner'\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\n\n// Navigation guards\nrouter.beforeEach(async (to, from, next) => {\n  const authStore = useAuthStore();\n\n  // Ждем инициализации авторизации\n  if (!authStore.initialized) {\n    await authStore.initializeAuth();\n  }\n  const isAuthenticated = authStore.isAuthenticated;\n  const userRole = authStore.user?.role;\n\n  // Если маршрут требует гостевой доступ (login)\n  if (to.meta.requiresGuest && isAuthenticated) {\n    if (userRole === 'admin') {\n      return next('/admin');\n    } else if (userRole === 'partner') {\n      return next('/dashboard');\n    } else {\n      // Если роль не определена, но пользователь authenticated, \n      // даем время роутеру определиться\n      return next();\n    }\n  }\n\n  // Если маршрут требует авторизации\n  if (to.meta.requiresAuth && !isAuthenticated) {\n    return next('/login');\n  }\n\n  // Если маршрут требует определенную роль\n  if (to.meta.requiresRole) {\n    // Если роль не совпадает\n    if (userRole && userRole !== to.meta.requiresRole) {\n      if (userRole === 'admin') {\n        return next('/admin');\n      } else if (userRole === 'partner') {\n        return next('/dashboard');\n      }\n    }\n\n    // Если роль не определена, но пользователь authenticated, \n    // возможно данные еще загружаются - редирект на login\n    if (!userRole && isAuthenticated) {\n      console.warn('User role is not defined, redirecting to login');\n      authStore.logout();\n      return next('/login');\n    }\n  }\n  next();\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","useAuthStore","routes","path","name","redirect","component","meta","requiresGuest","requiresAuth","requiresRole","router","history","beforeEach","to","from","next","authStore","initialized","initializeAuth","isAuthenticated","userRole","user","role","console","warn","logout"],"sources":["/Users/vadim/Desktop/freedom-group/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport { useAuthStore } from '@/stores/auth'\n\nconst routes = [\n  {\n    path: '/',\n    name: 'home',\n    redirect: '/login'\n  },\n  {\n    path: '/login',\n    name: 'login',\n    component: () => import('@/views/auth/LoginPage.vue'),\n    meta: { requiresGuest: true }\n  },\n  {\n    path: '/forgot-password',\n    name: 'forgot-password',\n    component: () => import('@/views/auth/ForgotPassword.vue'),\n    meta: { requiresGuest: true }\n  },\n  {\n    path: '/reset-password',\n    name: 'reset-password',\n    component: () => import('@/views/auth/ResetPassword.vue'),\n    meta: { requiresGuest: true }\n  },\n  {\n    path: '/verify-email',\n    name: 'verify-email',\n    component: () => import('@/views/auth/EmailVerify.vue'),\n    meta: { requiresGuest: true }\n  },\n  {\n    path: '/admin',\n    name: 'admin',\n    component: () => import('@/views/AdminDashboard.vue'),\n    meta: { requiresAuth: true, requiresRole: 'admin' }\n  },\n  {\n    path: '/dashboard',\n    name: 'dashboard', \n    component: () => import('@/views/PartnerDashboard.vue'),\n    meta: { requiresAuth: true, requiresRole: 'partner' }\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n})\n\n// Navigation guards\nrouter.beforeEach(async (to, from, next) => {\n  const authStore = useAuthStore()\n  \n  // Ждем инициализации авторизации\n  if (!authStore.initialized) {\n    await authStore.initializeAuth()\n  }\n  \n  const isAuthenticated = authStore.isAuthenticated\n  const userRole = authStore.user?.role\n  \n  // Если маршрут требует гостевой доступ (login)\n  if (to.meta.requiresGuest && isAuthenticated) {\n    if (userRole === 'admin') {\n      return next('/admin')\n    } else if (userRole === 'partner') {\n      return next('/dashboard')\n    } else {\n      // Если роль не определена, но пользователь authenticated, \n      // даем время роутеру определиться\n      return next()\n    }\n  }\n  \n  // Если маршрут требует авторизации\n  if (to.meta.requiresAuth && !isAuthenticated) {\n    return next('/login')\n  }\n  \n  // Если маршрут требует определенную роль\n  if (to.meta.requiresRole) {\n    // Если роль не совпадает\n    if (userRole && userRole !== to.meta.requiresRole) {\n      if (userRole === 'admin') {\n        return next('/admin')\n      } else if (userRole === 'partner') {\n        return next('/dashboard') \n      }\n    }\n    \n    // Если роль не определена, но пользователь authenticated, \n    // возможно данные еще загружаются - редирект на login\n    if (!userRole && isAuthenticated) {\n      console.warn('User role is not defined, redirecting to login')\n      authStore.logout()\n      return next('/login')\n    }\n  }\n  \n  next()\n})\n\nexport default router"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}