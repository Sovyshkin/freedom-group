(function(){"use strict";var e={5398:function(e,n,t){var r=t(5130),o=t(6768),a=t(144),i=(t(4114),t(4232)),s=t(1387),u=t(14);const c={class:"user-section"},l={key:0,class:"user"},d={key:1,class:"user"},f={key:2,class:"user"},m={key:3,class:"user"};var p={__name:"AppHeader",setup(e){const n=(0,u.n)(),t=(0,s.rd)(),r=()=>{t.push("/login"),n.logout()},p=(0,o.EW)((()=>n.user?"admin"===n.user.role?{name:"",surname:"",email:n.user.email||"",username:n.user.username||"admin"}:"partner"===n.user.role?{name:n.user.name||"",surname:"",email:n.user.email||"",username:n.user.alias||""}:{name:"",surname:"",email:"",username:""}:{name:"",surname:"",email:"",username:""}));return(0,o.sV)((()=>{console.log("AppHeader mounted, user:",n.user)})),(e,t)=>((0,o.uX)(),(0,o.CE)("header",null,[(0,o.Lk)("div",{class:"wrap-logo",onClick:t[0]||(t[0]=n=>e.$router.push("/"))}," FREEDOM GROUP "),(0,o.Lk)("div",c,["admin"===(0,a.R1)(n).user?.role?((0,o.uX)(),(0,o.CE)("span",l,(0,i.v_)(p.value.username),1)):"partner"===(0,a.R1)(n).user?.role?((0,o.uX)(),(0,o.CE)("span",d,(0,i.v_)(p.value.name||p.value.username||p.value.email||"Пользователь"),1)):(0,a.R1)(n).isAuthenticated?((0,o.uX)(),(0,o.CE)("span",f,(0,i.v_)(p.value.email||"Пользователь"),1)):((0,o.uX)(),(0,o.CE)("span",m," Гость ")),(0,a.R1)(n).isAuthenticated?((0,o.uX)(),(0,o.CE)("button",{key:4,class:"logout-btn",onClick:r,title:"Выйти"},[...t[1]||(t[1]=[(0,o.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[(0,o.Lk)("path",{d:"M6 2H3C2.45 2 2 2.45 2 3V13C2 13.55 2.45 14 3 14H6",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),(0,o.Lk)("path",{d:"M11 11L14 8L11 5",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),(0,o.Lk)("path",{d:"M14 8H6",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})],-1)])])):(0,o.Q3)("",!0)])]))}},h=t(1241);const v=(0,h.A)(p,[["__scopeId","data-v-8cb4e3ba"]]);var g=v,k=t(7881),y=t(1675);const b={key:0,class:"wrap-loader"};var w={__name:"App",setup(e){const n=(0,u.n)(),t=(0,s.lq)();return console.log("Initializing app, calling initializeAuth..."),(0,o.sV)((async()=>{await n.initializeAuth(),console.log("App mounted, user:",n.user),console.log("App mounted, isAuthenticated:",n.isAuthenticated),console.log("App mounted, current route:",t.name)})),(e,i)=>{const s=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)(o.FK,null,["login"!=(0,a.R1)(t).name&&"email_verify"!=(0,a.R1)(t).name?((0,o.uX)(),(0,o.Wv)(g,{key:0})):(0,o.Q3)("",!0),(0,o.Lk)("main",null,[(0,a.R1)(n).loading?((0,o.uX)(),(0,o.CE)("div",b,[(0,o.bF)(k.A)])):((0,o.uX)(),(0,o.Wv)(s,{key:1},{default:(0,o.k6)((({Component:e})=>[(0,o.bF)(r.eB,{name:"fade",mode:"out-in"},{default:(0,o.k6)((()=>[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e)))])),_:2},1024)])),_:1}))]),(0,o.bF)(y.A)],64)}}};const A=w;var C=A,E=(t(8082),t(2261));const L=[{path:"/",name:"home",redirect:"/login"},{path:"/login",name:"login",component:()=>t.e(551).then(t.bind(t,7551)),meta:{requiresGuest:!0}},{path:"/forgot-password",name:"forgot-password",component:()=>t.e(776).then(t.bind(t,9776)),meta:{requiresGuest:!0}},{path:"/reset-password",name:"reset-password",component:()=>t.e(271).then(t.bind(t,6271)),meta:{requiresGuest:!0}},{path:"/verify-email",name:"verify-email",component:()=>t.e(882).then(t.bind(t,601)),meta:{requiresGuest:!0}},{path:"/admin",name:"admin",component:()=>t.e(965).then(t.bind(t,3965)),meta:{requiresAuth:!0,requiresRole:"admin"}},{path:"/dashboard",name:"dashboard",component:()=>t.e(542).then(t.bind(t,1542)),meta:{requiresAuth:!0,requiresRole:"partner"}}],_=(0,s.aE)({history:(0,s.LA)(),routes:L});_.beforeEach((async(e,n,t)=>{const r=(0,u.n)();r.initialized||await r.initializeAuth();const o=r.isAuthenticated,a=r.user?.role;if(e.meta.requiresGuest&&o)return"admin"===a?t("/admin"):"partner"===a?t("/dashboard"):t();if(e.meta.requiresAuth&&!o)return t("/login");if(e.meta.requiresRole){if(a&&a!==e.meta.requiresRole){if("admin"===a)return t("/admin");if("partner"===a)return t("/dashboard")}if(!a&&o)return console.warn("User role is not defined, redirecting to login"),r.logout(),t("/login")}t()}));var I=_,S=t(5827),R=t(6726);const O=(0,E.Ey)();O.use(S.A),(0,r.Ef)(C).use(I).use(O).use(R.Ay).mount("#app")},8082:function(e,n,t){var r=t(4373),o=t(14);const a=()=>{const e=window.location.hostname;return"localhost"!==e&&"127.0.0.1"!==e?`http://${e}/api`:"http://localhost:3001/api"};r.A.defaults.baseURL=a(),r.A.interceptors.request.use((e=>{const n=localStorage.getItem("authToken");return n&&(e.headers.Authorization=`Bearer ${n}`),e}),(e=>Promise.reject(e))),r.A.interceptors.response.use((e=>e),(async e=>{const n=e.config;if(401===e.response?.status&&!n._retry){n._retry=!0;const t=(0,o.n)();return console.error("401 Unauthorized - logging out"),t.logout(),"/login"!==window.location.pathname&&(window.location.href="/login"),Promise.reject(e)}return Promise.reject(e)})),n.A=r.A},14:function(e,n,t){t.d(n,{n:function(){return i}});var r=t(2261),o=t(144),a=t(8082);const i=(0,r.nY)("auth",(()=>{const e=(0,o.KR)(null),n=(0,o.KR)(localStorage.getItem("authToken")||null),t=(0,o.KR)(!!n.value),r=(0,o.KR)(!1),i=(0,o.KR)(!1),s=localStorage.getItem("authUser");if(s)try{e.value=JSON.parse(s)}catch(m){console.error("Error parsing stored user:",m),localStorage.removeItem("authUser")}const u=async(r,o)=>{try{const i=await a.A.post(r,o);if(i.data.success)return n.value=i.data.token,e.value=i.data.user,t.value=!0,localStorage.setItem("authToken",n.value),localStorage.setItem("authUser",JSON.stringify(e.value)),a.A.defaults.headers.common["Authorization"]=`Bearer ${n.value}`,i.data;throw new Error(i.data.message||"Login failed")}catch(i){throw console.error("Login error:",i),i}},c=()=>{e.value=null,n.value=null,t.value=!1,localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),delete a.A.defaults.headers.common["Authorization"]},l=async()=>{if(n.value){a.A.defaults.headers.common["Authorization"]=`Bearer ${n.value}`;try{const n=await a.A.get("/auth/verify");n.data.success?(e.value=n.data.user,t.value=!0,localStorage.setItem("authUser",JSON.stringify(e.value)),console.log("Auth initialized with valid token")):(console.log("Token is invalid, logging out"),c())}catch(r){console.error("Token verification failed:",r),c()}}else console.log("No token found, user is not authenticated");i.value=!0},d=async()=>l(),f=n=>{e.value={...e.value,...n}};return{user:e,token:n,isAuthenticated:t,loading:r,initialized:i,login:u,logout:c,initAuth:d,initializeAuth:l,updateUser:f}}))},3966:function(e,n,t){t.d(n,{i:function(){return a}});t(4114);var r=t(2261),o=t(144);const a=(0,r.nY)("notifications",(()=>{const e=(0,o.KR)([]);let n=0;const t=t=>{const o=++n,a={id:o,type:t.type||"info",message:t.message,duration:t.duration||5e3,createdAt:new Date};return e.value.push(a),a.duration>0&&setTimeout((()=>{r(o)}),a.duration),o},r=n=>{const t=e.value.findIndex((e=>e.id===n));t>-1&&e.value.splice(t,1)},a=()=>{e.value=[]},i=(e,n=3e3)=>t({type:"success",message:e,duration:n}),s=(e,n=5e3)=>t({type:"error",message:e,duration:n}),u=(e,n=4e3)=>t({type:"warning",message:e,duration:n}),c=(e,n=3e3)=>t({type:"info",message:e,duration:n});return{notifications:e,addNotification:t,removeNotification:r,clearNotifications:a,addSuccess:i,addError:s,addWarning:u,addInfo:c}}))},7881:function(e,n,t){t.d(n,{A:function(){return c}});var r=t(6768);const o={class:"loader-center"};function a(e,n){return(0,r.uX)(),(0,r.CE)("div",o,[...n[0]||(n[0]=[(0,r.Lk)("svg",{viewBox:"25 25 50 50",class:"loader-svg"},[(0,r.Lk)("circle",{r:"20",cy:"50",cx:"50"})],-1)])])}var i=t(1241);const s={},u=(0,i.A)(s,[["render",a],["__scopeId","data-v-7848fe08"]]);var c=u},1675:function(e,n,t){t.d(n,{A:function(){return g}});var r=t(6768),o=t(5130),a=t(144),i=t(4232),s=t(3966);const u={class:"notifications-container"},c={class:"notification-content"},l={class:"notification-icon"},d={class:"notification-text"},f=["onClick"],m={components:{SuccessIcon:{template:'\n        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">\n          <path d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z" fill="currentColor"/>\n          <path d="M6 10L8.5 12.5L14 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      '},ErrorIcon:{template:'\n        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">\n          <path d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z" fill="currentColor"/>\n          <path d="M10 6V10M10 14H10.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      '},WarningIcon:{template:'\n        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">\n          <path d="M8.485 3.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 3.495zM10 8a.75.75 0 01.75.75v2.5a.75.75 0 01-1.5 0v-2.5A.75.75 0 0110 8zm0 6a1 1 0 100-2 1 1 0 000 2z" fill="currentColor"/>\n        </svg>\n      '},InfoIcon:{template:'\n        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">\n          <path d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z" fill="currentColor"/>\n          <path d="M10 8V12M10 6H10.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      '}}};var p=Object.assign(m,{__name:"AppNotifications",setup(e){const n=(0,s.i)(),t=e=>{switch(e){case"success":return"SuccessIcon";case"error":return"ErrorIcon";case"warning":return"WarningIcon";case"info":default:return"InfoIcon"}};return(e,s)=>((0,r.uX)(),(0,r.CE)("div",u,[(0,r.bF)(o.F,{name:"notification",tag:"div"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,a.R1)(n).notifications,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,i.C4)(["notification",e.type])},[(0,r.Lk)("div",c,[(0,r.Lk)("div",l,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(t(e.type))))]),(0,r.Lk)("span",d,(0,i.v_)(e.message),1),(0,r.Lk)("button",{class:"notification-close",onClick:t=>(0,a.R1)(n).removeNotification(e.id)},[...s[0]||(s[0]=[(0,r.Lk)("i",{class:"fas fa-times"},null,-1)])],8,f)])],2)))),128))])),_:1})]))}}),h=t(1241);const v=(0,h.A)(p,[["__scopeId","data-v-31ab2f8c"]]);var g=v}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var a=n[r]={exports:{}};return e[r].call(a.exports,a,a.exports,t),a.exports}t.m=e,function(){var e=[];t.O=function(n,r,o,a){if(!r){var i=1/0;for(l=0;l<e.length;l++){r=e[l][0],o=e[l][1],a=e[l][2];for(var s=!0,u=0;u<r.length;u++)(!1&a||i>=a)&&Object.keys(t.O).every((function(e){return t.O[e](r[u])}))?r.splice(u--,1):(s=!1,a<i&&(i=a));if(s){e.splice(l--,1);var c=o();void 0!==c&&(n=c)}}return n}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[r,o,a]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}}(),function(){t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce((function(n,r){return t.f[r](e,n),n}),[]))}}(),function(){t.u=function(e){return"js/"+e+"."+{271:"98498189",542:"88f81f3f",551:"bec2bf0f",776:"0d64d26a",882:"23de91c9",965:"3a596efc"}[e]+".js"}}(),function(){t.miniCssF=function(e){return"css/"+e+"."+{271:"7895f3e7",542:"5d00ba2a",551:"d4b5e4ff",776:"6cfdc0f8",882:"910e658b",965:"085f4235"}[e]+".css"}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={},n="app:";t.l=function(r,o,a,i){if(e[r])e[r].push(o);else{var s,u;if(void 0!==a)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==n+a){s=d;break}}s||(u=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,t.nc&&s.setAttribute("nonce",t.nc),s.setAttribute("data-webpack",n+a),s.src=r),e[r]=[o];var f=function(n,t){s.onerror=s.onload=null,clearTimeout(m);var o=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((function(e){return e(t)})),n)return n(t)},m=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,n,r,o,a){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",t.nc&&(i.nonce=t.nc);var s=function(t){if(i.onerror=i.onload=null,"load"===t.type)o();else{var r=t&&t.type,s=t&&t.target&&t.target.href||n,u=new Error("Loading CSS chunk "+e+" failed.\n("+r+": "+s+")");u.name="ChunkLoadError",u.code="CSS_CHUNK_LOAD_FAILED",u.type=r,u.request=s,i.parentNode&&i.parentNode.removeChild(i),a(u)}};return i.onerror=i.onload=s,i.href=n,r?r.parentNode.insertBefore(i,r.nextSibling):document.head.appendChild(i),i},n=function(e,n){for(var t=document.getElementsByTagName("link"),r=0;r<t.length;r++){var o=t[r],a=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(a===e||a===n))return o}var i=document.getElementsByTagName("style");for(r=0;r<i.length;r++){o=i[r],a=o.getAttribute("data-href");if(a===e||a===n)return o}},r=function(r){return new Promise((function(o,a){var i=t.miniCssF(r),s=t.p+i;if(n(i,s))return o();e(r,s,null,o,a)}))},o={524:0};t.f.miniCss=function(e,n){var t={271:1,542:1,551:1,776:1,882:1,965:1};o[e]?n.push(o[e]):0!==o[e]&&t[e]&&n.push(o[e]=r(e).then((function(){o[e]=0}),(function(n){throw delete o[e],n})))}}}(),function(){var e={524:0};t.f.j=function(n,r){var o=t.o(e,n)?e[n]:void 0;if(0!==o)if(o)r.push(o[2]);else{var a=new Promise((function(t,r){o=e[n]=[t,r]}));r.push(o[2]=a);var i=t.p+t.u(n),s=new Error,u=function(r){if(t.o(e,n)&&(o=e[n],0!==o&&(e[n]=void 0),o)){var a=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;s.message="Loading chunk "+n+" failed.\n("+a+": "+i+")",s.name="ChunkLoadError",s.type=a,s.request=i,o[1](s)}};t.l(i,u,"chunk-"+n,n)}},t.O.j=function(n){return 0===e[n]};var n=function(n,r){var o,a,i=r[0],s=r[1],u=r[2],c=0;if(i.some((function(n){return 0!==e[n]}))){for(o in s)t.o(s,o)&&(t.m[o]=s[o]);if(u)var l=u(t)}for(n&&n(r);c<i.length;c++)a=i[c],t.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return t.O(l)},r=self["webpackChunkapp"]=self["webpackChunkapp"]||[];r.forEach(n.bind(null,0)),r.push=n.bind(null,r.push.bind(r))}();var r=t.O(void 0,[504],(function(){return t(5398)}));r=t.O(r)})();
//# sourceMappingURL=app.a2235526.js.map